# 开发日志

## ✅ 功能名称：接收 `add.csv` 作为输入

**完成时间**：2024-03-27  
**开发人**：Cursor

### 🔧 本次修改内容：
- 创建了`encrypt_csv.py`文件
- 实现了CSV文件的基本读取功能:
  - 使用pandas读取CSV文件
  - 添加了文件存在性检查
  - 添加了文件内容空检查
  - 实现了异常处理机制
- 添加了详细的中文注释,包括:
  - 文件头部说明
  - 函数文档字符串
  - 代码内行注释

### 📁 涉及文件：
- 新建: `/encrypt_csv.py`
- 修改: `/doc/todolist.md`
- 新建: `/doc/cursor-log.md`

### ✅ 实现效果：
- 功能已完整实现
- 测试方法:
  1. 文件存在时能正确读取并显示行数
  2. 文件不存在时会显示错误信息
  3. 文件为空时会显示错误信息

### 📝 下一步计划：
- 实现用户密码的安全输入功能

---

## ✅ 功能名称：安全输入用户密码（使用 getpass）

**完成时间**：2024-03-27  
**开发人**：Cursor

### 🔧 本次修改内容：
- 在`encrypt_csv.py`中添加了密码输入功能:
  - 使用getpass模块实现密码隐藏输入
  - 添加了密码确认机制
  - 实现了基本的密码强度验证(长度检查)
  - 添加了详细的错误提示
- 更新了主函数以使用新的密码输入功能

### 📁 涉及文件：
- 修改: `/encrypt_csv.py`
- 修改: `/doc/todolist.md`
- 修改: `/doc/cursor-log.md`

### ✅ 实现效果：
- 功能已完整实现
- 测试方法:
  1. 密码输入时字符不显示
  2. 两次输入不匹配时会提示重试
  3. 密码长度小于8时会提示重试
  4. 密码验证成功后会显示提示

### 📝 下一步计划：
- 实现salt和nonce的生成功能

---

## ✅ 功能名称：生成 salt 和 nonce

**完成时间**：2024-03-27  
**开发人**：Cursor

### 🔧 本次修改内容：
- 在`encrypt_csv.py`中添加了加密参数生成功能:
  - 添加了cryptography库相关依赖
  - 实现了generate_salt_and_nonce函数
  - 使用os.urandom生成安全的随机数
  - 生成16字节salt和12字节nonce
- 更新了主函数以使用新生成的参数

### 📁 涉及文件：
- 修改: `/encrypt_csv.py`
- 修改: `/doc/todolist.md`
- 修改: `/doc/cursor-log.md`

### ✅ 实现效果：
- 功能已完整实现
- 测试方法:
  1. 运行程序验证salt和nonce是否成功生成
  2. 检查salt长度是否为16字节
  3. 检查nonce长度是否为12字节
  4. 多次运行验证生成的值是否随机

### 📝 下一步计划：
- 实现使用Argon2id派生AES密钥的功能

---

## ✅ 功能名称：使用 Argon2id 派生 AES 密钥

**完成时间**：2024-03-27  
**开发人**：Cursor

### 🔧 本次修改内容：
- 在`encrypt_csv.py`中添加了密钥派生功能:
  - 添加了argon2-cffi库相关依赖
  - 实现了derive_key函数
  - 使用RFC 9106推荐的高内存参数配置
  - 从Argon2id哈希中提取AES-256密钥
- 更新了主函数以使用派生的密钥

### 📁 涉及文件：
- 修改: `/encrypt_csv.py`
- 修改: `/doc/todolist.md`
- 修改: `/doc/cursor-log.md`

### ✅ 实现效果：
- 功能已完整实现
- 测试方法:
  1. 运行程序验证密钥是否成功派生
  2. 检查派生的密钥长度是否为32字节
  3. 验证使用相同密码和salt时得到相同密钥
  4. 验证使用不同salt时得到不同密钥

### 📝 下一步计划：
- 实现使用AES-256-GCM加密数据的功能

---

## ✅ 功能名称：使用 AES-256-GCM 加密数据

**完成时间**：2024-03-27  
**开发人**：Cursor

### 🔧 本次修改内容：
- 在`encrypt_csv.py`中添加了数据加密功能:
  - 添加了json库用于序列化DataFrame
  - 实现了encrypt_data函数
  - 使用AES-256-GCM进行加密
  - 添加了加密过程的错误处理
- 更新了主函数以使用加密功能

### 📁 涉及文件：
- 修改: `/encrypt_csv.py`
- 修改: `/doc/todolist.md`
- 修改: `/doc/cursor-log.md`

### ✅ 实现效果：
- 功能已完整实现
- 测试方法:
  1. 运行程序验证数据是否成功加密
  2. 检查加密后数据大小是否合理
  3. 验证每次加密得到的密文是否不同(由于nonce随机)
  4. 确认加密过程中没有错误发生

### 📝 下一步计划：
- 实现将加密结果输出到encrypted_add.csv文件

---

## ✅ 功能名称：输出加密结果为 encrypted_add.csv

**完成时间**：2024-03-27  
**开发人**：Cursor

### 🔧 本次修改内容：
- 在`encrypt_csv.py`中添加了加密结果保存功能:
  - 实现了save_encrypted_file函数
  - 按照ERD中定义的格式写入数据:
    - salt (16字节)
    - nonce (12字节)
    - 密文和认证标签
  - 添加了文件写入的错误处理
- 更新了主函数以保存加密结果

### 📁 涉及文件：
- 修改: `/encrypt_csv.py`
- 修改: `/doc/todolist.md`
- 修改: `/doc/cursor-log.md`

### ✅ 实现效果：
- 功能已完整实现
- 测试方法:
  1. 运行程序验证加密文件是否成功生成
  2. 检查文件大小是否正确(salt+nonce+密文+tag)
  3. 使用二进制编辑器验证文件格式
  4. 确认文件写入过程中没有错误发生

### 📝 下一步计划：
- 实现可选删除add.csv明文的功能

---

## ✅ 功能名称：可选删除 add.csv 明文

**完成时间**：2024-03-27  
**开发人**：Cursor

### 🔧 本次修改内容：
- 在`encrypt_csv.py`中添加了明文文件删除功能:
  - 添加了argparse库用于解析命令行参数
  - 实现了delete_plaintext_file函数
  - 添加了-d/--delete命令行选项
  - 添加了文件删除的错误处理
- 更新了主函数以支持可选删除功能

### 📁 涉及文件：
- 修改: `/encrypt_csv.py`
- 修改: `/doc/todolist.md`
- 修改: `/doc/cursor-log.md`

### ✅ 实现效果：
- 功能已完整实现
- 测试方法:
  1. 不带参数运行时不删除明文文件
  2. 使用-d参数运行时删除明文文件
  3. 文件不存在时显示适当提示
  4. 确认删除过程中没有错误发生

### 📝 下一步计划：
- encrypt_csv.py模块开发完成,准备开始开发decrypt_utils.py

## ✅ 功能名称：实现 decrypt_csv(file_path, password)

**完成时间**：2024-03-27  
**开发人**：Cursor

### 🔧 本次修改内容：
- 创建了decrypt_utils.py文件
- 实现了decrypt_csv函数的基本结构
- 添加了必要的导入语句
- 实现了基本的错误处理机制
- 添加了详细的文档字符串

### 📁 涉及文件：
- decrypt_utils.py (新建)
- doc/todolist.md (更新)

### ✅ 实现效果：
- 成功创建了decrypt_utils.py文件
- 实现了函数的基本框架
- 完成了文件存在性检查
- 准备好了后续功能的TODO标记
- 尚未实现具体的解密功能,将在后续任务中完成

### 📝 下一步计划：
- 实现读取salt和nonce的功能
- 实现密钥派生功能
- 实现数据解密功能
- 实现DataFrame转换功能

## ✅ 功能名称：读取 salt 和 nonce

**完成时间**：2024-03-27  
**开发人**：Cursor

### 🔧 本次修改内容：
- 在decrypt_utils.py中添加了加密文件读取功能:
  - 实现了read_encrypted_file函数
  - 按照文件格式读取各个部分:
    - 16字节的salt
    - 12字节的nonce
    - 剩余的密文和认证标签
  - 添加了格式验证和错误处理
- 更新了decrypt_csv函数以使用新的读取功能

### 📁 涉及文件：
- decrypt_utils.py (修改)
- doc/todolist.md (更新)

### ✅ 实现效果：
- 功能已完整实现
- 测试方法:
  1. 读取正确格式的加密文件成功
  2. 文件格式错误时会显示具体错误信息
  3. salt长度不正确时会报错
  4. nonce长度不正确时会报错
  5. 密文太短时会报错

### 📝 下一步计划：
- 实现密钥派生和AES-256-GCM解密功能

## ✅ 功能名称：派生密钥并使用 AES-256-GCM 解密

**完成时间**：2024-03-27  
**开发人**：Cursor

### 🔧 本次修改内容：
- 在decrypt_utils.py中添加了密钥派生和解密功能:
  - 实现了derive_key函数:
    - 使用Argon2id进行密钥派生
    - 使用RFC 9106推荐的高内存参数
    - 从哈希中提取AES密钥
  - 实现了decrypt_data函数:
    - 使用AES-256-GCM进行解密
    - 自动验证GCM认证标签
    - 处理密码错误和数据篡改情况
  - 更新了decrypt_csv函数以使用新功能
  - 添加了详细的错误处理机制

### 📁 涉及文件：
- decrypt_utils.py (修改)
- doc/todolist.md (更新)

### ✅ 实现效果：
- 功能已完整实现
- 测试方法:
  1. 使用正确密码可以成功解密数据
  2. 密码错误时会提示相应错误
  3. 数据被篡改时会提示认证失败
  4. 密钥派生过程使用了安全的参数

### 📝 下一步计划：
- 实现将解密后的数据转换为DataFrame的功能

## ✅ 功能名称：提供异常处理机制

**完成时间**：2024-03-27  
**开发人**：Cursor

### 🔧 本次修改内容：
- 检查并确认了所有函数中的异常处理机制:
  - read_encrypted_file函数:
    - 文件不存在检查
    - 文件格式验证
    - 读取错误处理
  - derive_key函数:
    - 密钥派生错误处理
  - decrypt_data函数:
    - 密码错误处理
    - 数据篡改检测
    - 解密错误处理
  - bytes_to_dataframe函数:
    - JSON解析错误处理
    - DataFrame转换错误处理
    - 空数据检查
  - decrypt_csv函数:
    - 统一的错误处理和提示
    - 清晰的错误分类
    - 用户友好的错误消息

### 📁 涉及文件：
- doc/todolist.md (更新)

### ✅ 实现效果：
- 异常处理机制已经完整实现
- 测试方法:
  1. 文件不存在时显示正确错误
  2. 文件格式错误时提供具体提示
  3. 密码错误时给出明确提示
  4. 数据被篡改时可以检测
  5. 数据格式错误时提供详细信息
  6. 所有错误消息都清晰易懂

### 📝 下一步计划：
- decrypt_utils.py模块开发完成
- 准备开始编写项目README文档

## ✅ 功能名称：编写项目文档

**完成时间**：2024-03-27  
**开发人**：Cursor

### 🔧 本次修改内容：
- 创建了CHANGELOG.md:
  - 记录v1.0.0版本的更新内容
  - 包含新功能、优化、文件调整等信息
  - 添加了备注说明和注意事项
- 创建了README.md:
  - 项目简介和功能特点
  - 安装和使用说明
  - 详细的技术文档
  - 安全说明和注意事项
  - 项目结构和开发文档链接
  - 未来计划和许可证信息

### 📁 涉及文件：
- README.md (新建)
- CHANGELOG.md (新建)
- doc/todolist.md (更新)

### ✅ 实现效果：
- 完整的项目文档已经就绪
- 包含了所有必要的信息:
  1. 使用说明清晰易懂
  2. 技术细节解释充分
  3. 安全注意事项完整
  4. 项目结构清晰
  5. 文档之间相互链接

### 📝 下一步计划：
- 项目v1.0.0版本开发完成
- 可以考虑添加单元测试
- 可以考虑支持更多文件格式 